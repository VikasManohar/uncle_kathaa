{{- define "main" }}

{{- /* Use the same listing logic as the site's default list but aggregate mainSections */ -}}

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections -}}
{{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" -}}
{{- $paginator := .Paginate $pages -}}

{{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
{{- partial "home_info.html" . }}
{{- end }}

{{- $term := .Data.Term }}
{{- range $index, $page := $paginator.Pages }}

{{- $class := "post-entry" }}

{{- $user_preferred := or site.Params.disableSpecial1stPost site.Params.homeInfoParams }}
{{- if (and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) (not $user_preferred)) }}
{{- $class = "first-entry" }}
{{- else if $term }}
{{- $class = "post-entry tag-entry" }}
{{- end }}

<article class="{{ $class }}">
    {{- $isHidden := ($page.Param "cover.hiddenInList") | default ($page.Param "cover.hidden") | default false }}
    {{- partial "cover.html" (dict "cxt" $page "IsSingle" false "isHidden" $isHidden) }}
    <header class="entry-header">
        <h2 class="entry-hint-parent">
            {{- $page.Title }}
            {{- if $page.Draft }}
            <span class="entry-hint" title="Draft">
                <!-- draft icon -->
            </span>
            {{- end }}
        </h2>
    </header>
    {{- if (ne ($page.Param "hideSummary") true) }}
    <div class="entry-content">
        <p>{{ $page.Summary | plainify | htmlUnescape }}{{ if $page.Truncated }}...{{ end }}</p>
    </div>
    {{- end }}
    {{- if not ($page.Param "hideMeta") }}
    <footer class="entry-footer">
        {{- partial "post_meta.html" $page -}}
    </footer>
    {{- end }}

    {{- if $page.Params.tags }}
    <div class="tags" style="padding: 2px;">
        <div style="display: flex; flex-wrap: wrap; justify-content: flex-end; margin-top: 1px;">
            {{ range $page.Params.tags }}
            <a href="/tags/{{ . | urlize }}" style="margin-right: 5px; 
                  color: white; 
                  background-color: rgb(55, 56, 62); 
                  border-radius: 6px; 
                  padding: 1px 12px; ">
                {{ . }}
            </a>
            {{ end }}
        </div>
    </div>
    {{- end }}

    <a class="entry-link" aria-label="post link to {{ $page.Title | plainify }}" href="{{ $page.Permalink }}"></a>
</article>
{{- end }}

{{- if gt $paginator.TotalPages 1 }}
<footer class="page-footer">
    <nav class="pagination"
        style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; width: 100%;">
        <div style="justify-self: start;">
            {{- if $paginator.HasPrev }}
            <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">
                «&nbsp;{{ i18n "prev_page" }}
            </a>
            {{- end }}
        </div>

        <div style="display: flex; gap: 8px; justify-self: center;">
            {{- range $pager := $paginator.Pagers }}
            {{- if eq $pager.PageNumber $paginator.PageNumber }}
            <span class="current"
                style="color: var(--theme); font-size: 13px; line-height: 36px; background: var(--secondary); border-radius: calc(36px / 2); padding: 0 16px; display: inline-block;">{{
                $pager.PageNumber }}</span>
            {{- else }}
            <a href="{{ $pager.URL | absURL }}"
                style="color: var(--theme); font-size: 13px; line-height: 36px; background: var(--primary); border-radius: calc(36px / 2); padding: 0 16px; text-decoration: none; display: inline-block;">{{
                $pager.PageNumber }}</a>
            {{- end }}
            {{- end }}
        </div>

        <div style="justify-self: end;">
            {{- if $paginator.HasNext }}
            <a class="next" href="{{ $paginator.Next.URL | absURL }}">
                {{ i18n "next_page" }}&nbsp;»
            </a>
            {{- end }}
        </div>
    </nav>
</footer>
{{- end }}

{{- end }}

{{- /* Head custom content area start */ -}}
{{- /* Insert any custom code (web-analytics, resources, etc.) - it will appear in the

<head>
    <link rel="icon" type="image/x-icon" href="{{ "favicon.ico" | absURL }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ "apple-touch-icon.png" | absURL }}">
    <!-- Required Open Graph tags -->
    <meta property="og:title" content="Uncle Kathaa" />
    <meta property="og:description" content="Stories of wisdom, culture, and heritage curated by Dr. Rao." />
    <meta property="og:image" content="https://unclekathaa.vercel.app/og-image.png" />
    <meta property="og:url" content="https://unclekathaa.vercel.app/" />
    <meta property="og:type" content="website" />

    <!-- Twitter card (optional but recommended) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Uncle Kathaa" />
    <meta name="twitter:description" content="Stories of wisdom, culture, and heritage curated by Dr. Rao." />
    <meta name="twitter:image" content="https://unclekathaa.vercel.app/og-image.png" />
</head> section of every page. */ -}}
{{- /* Can be overwritten by partial with the same name in the global layouts. */ -}}

{{- /* GoatCounter Analytics */ -}}
{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
<script>
    window.goatcounter = {
        endpoint: 'https://unclekathaa.goatcounter.com/count'
    };
</script>
<script async data-goatcounter src="/js/count.js"></script>

<noscript>
    <img src="https://unclekathaa.goatcounter.com/count?p={{ .RelPermalink }}" alt="." />
</noscript>

{{- /* GoatCounter API for fetching page views */ -}}
<script>
    // Function to fetch and display page views
    async function fetchPageViews(path) {
        try {
            const response = await fetch(`https://unclekathaa.goatcounter.com/counter/${encodeURIComponent(path)}.json`);
            if (response.ok) {
                const data = await response.json();
                return data.count || 0;
            }
        } catch (error) {
            console.log('Could not fetch page views:', error);
        }
        return 0;
    }

    // Display page views when DOM is loaded
    document.addEventListener('DOMContentLoaded', function () {
        // Get all page view elements
        const viewCountElements = document.querySelectorAll('.page-views');

        viewCountElements.forEach(async (element) => {
            // Get the path from data attribute, or use current page path as fallback
            const path = element.getAttribute('data-path') || window.location.pathname;

            try {
                const count = await fetchPageViews(path);
                if (count > 0) {
                    element.textContent = count + ' views';
                    element.style.display = 'inline';
                } else {
                    // Remove the element from the DOM if count is zero
                    element.parentNode && element.parentNode.removeChild(element);
                }
            } catch (error) {
                // Remove the element from the DOM if there is an error
                element.parentNode && element.parentNode.removeChild(element);
            }
        });
    });
</script>
{{- end -}}

{{- /* Head custom content area end */ -}}